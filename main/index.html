<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中国象棋 - 单机版</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .series-btn {
            position: relative;
            text-align: left;
            padding: 12px 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            margin: 5px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .series-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            background: linear-gradient(135deg, #764ba2, #667eea);
        }
        
        .game-count {
            position: absolute;
            right: 10px;
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .series-games-list {
            max-height: 500px;
            overflow-y: auto;
            margin-top: 15px;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }
        
        .series-game-item {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .series-game-item:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .game-title {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .game-info {
            color: #87ceeb;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .game-meta {
            color: #98fb98;
            font-size: 0.85em;
            margin-bottom: 5px;
        }
        
        .game-moves {
            color: #ffa07a;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .game-quality {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75em;
            margin-left: 8px;
            background: rgba(255,255,255,0.2);
        }
        
        .back-btn {
            background: linear-gradient(135deg, #666, #888);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: linear-gradient(135deg, #888, #aaa);
            transform: translateY(-1px);
        }
        
        .series-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255,255,255,0.3);
        }
    </style>
    <script src="audio-manager.js"></script>
    <script src="chess-notation-parser.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>中国象棋</h1>
            <div class="game-controls">
                <button id="newGame">新游戏</button>
                <button id="undo">悔棋</button>
                <button id="showGameRecords">全局棋谱</button>
                <button id="audioToggle" class="audio-btn">🔊 音效</button>
            </div>
            
            <!-- 音量控制面板 -->
            <div id="audioControls" class="audio-controls">
                <div class="volume-control">
                    <label for="musicVolume">🎵 背景音乐:</label>
                    <input type="range" id="musicVolume" min="0" max="100" value="30" class="volume-slider">
                    <span id="musicVolumeValue">30%</span>
                </div>
                <div class="volume-control">
                    <label for="effectVolume">🔊 音效:</label>
                    <input type="range" id="effectVolume" min="0" max="100" value="60" class="volume-slider">
                    <span id="effectVolumeValue">60%</span>
                </div>
            </div>
        </header>

        <div class="game-board">
            <div class="board">
                <!-- 棋盘格子将由JavaScript动态生成 -->
            </div>
            <div class="status">
                <div id="currentPlayer">当前回合: 红方</div>
                <div id="gameStatus">游戏状态: 进行中</div>
            </div>
        </div>

        <div class="captured-pieces">
            <div class="red-captured">被吃红子: </div>
            <div class="black-captured">被吃黑子: </div>
        </div>
    </div>

    <!-- 棋谱展示面板 -->
    <div id="recordPanel" class="record-panel hidden">
        <div class="record-header">
            <h2>经典棋谱选择</h2>
            <button id="closeRecords" class="close-btn">×</button>
        </div>
        
        <!-- 分类导航区域 -->
        <div class="classification-nav">
            <button id="categoryToggle" class="category-toggle-btn">📂 分类目录</button>
            <div id="categorySelection" class="category-selection hidden">
                <h4>棋谱分类</h4>
                <div id="categoryList" class="category-list">
                    <!-- 动态分类列表将在这里生成 -->
                </div>
            </div>
        </div>

        <!-- 棋谱选择按钮区域 -->
        <div class="record-selection">
            <h3>选择棋谱：</h3>
            <div id="recordButtons" class="record-buttons">
                <!-- 分类棋谱内容将动态生成 -->
            </div>
        </div>
        
        <!-- 棋谱步骤展示区域 -->
        <div id="recordDisplay" class="record-display hidden">
            <div class="record-info">
                <h3 id="recordTitle">棋谱名称</h3>
                <div class="play-controls">
                    <button id="playBtn">▶ 播放</button>
                    <button id="pauseBtn">⏸ 暂停</button>
                    <button id="resetBtn">↻ 重置</button>
                    <div class="speed-control">
                        <label>速度：</label>
                        <select id="playSpeed">
                            <option value="2000">慢速</option>
                            <option value="1000" selected>正常</option>
                            <option value="500">快速</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="record-steps">
                <ol id="stepsList" class="steps-list">
                    <!-- 棋谱步骤将由JavaScript生成 -->
                </ol>
            </div>
        </div>

        <!-- 棋谱系列展示区域 -->
        <div id="seriesDisplay" class="record-display hidden">
            <div class="series-header">
                <h3 id="seriesTitle">棋谱系列</h3>
                <button id="backToSeries" class="back-btn">← 返回系列列表</button>
            </div>
            <div class="series-info" id="seriesInfo">
                <!-- 系列统计信息 -->
            </div>
            <div class="series-games-list" id="seriesGamesList">
                <!-- 系列中的棋谱列表将由JavaScript生成 -->
            </div>
        </div>
    </div>

    <script src="chess.js"></script>
    <script>
        // 游戏初始化和交互功能
        document.addEventListener('DOMContentLoaded', function() {
            console.log('中国象棋页面加载完成');

            setTimeout(() => {
                if (window.game) {
                    console.log('✅ 游戏初始化成功');
                    console.log('棋子数量:', window.game.pieces.length);
                } else {
                    console.log('❌ 游戏初始化失败');
                }
            }, 500);

            // 关闭棋谱面板按钮
            const closeRecordsBtn = document.getElementById('closeRecords');
            if (closeRecordsBtn) {
                closeRecordsBtn.addEventListener('click', function() {
                    const recordPanel = document.getElementById('recordPanel');
                    if (recordPanel) {
                        recordPanel.classList.add('hidden');
                        console.log('棋谱面板已关闭');
                    }
                });
            }

            // 分类功能控制
            const categoryToggle = document.getElementById('categoryToggle');
   const categorySelection = document.getElementById('categorySelection');

         if (categoryToggle && categorySelection) {
                // 分类切换按钮事件
          categoryToggle.addEventListener('click', function() {
     categorySelection.classList.toggle('hidden');
      console.log('分类面板切换:', !categorySelection.classList.contains('hidden'));

                // 如果打开分类面板，显示分类棋谱
       if (!categorySelection.classList.contains('hidden') && window.game) {
     window.game.showClassificationPanel();
     }
        });
        }

            // 棋谱选择按钮
            const recordButtons = document.querySelectorAll('.record-btn');
       console.log('找到棋谱按钮:', recordButtons.length);

            recordButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const gameName = this.getAttribute('data-game');
                    console.log('选择棋谱:', gameName);

                    if (window.game && window.game.setupFamousGame) {
                        // 隐藏棋谱选择界面
                        document.querySelector('.record-selection').classList.add('hidden');

                        // 显示棋谱步骤界面
                        document.getElementById('recordDisplay').classList.remove('hidden');

                        // 设置标题
                        document.getElementById('recordTitle').textContent = gameName;

                        // 加载棋局
                        window.game.setupFamousGame(gameName);
                        console.log('棋谱加载完成:', gameName);
                    } else {
                        console.log('❌ 游戏对象或方法不可用');
                        alert('游戏尚未初始化完成，请稍后再试');
                    }
                });
            });

            // 重置按钮
            const resetBtn = document.getElementById('resetBtn');
            if (resetBtn) {
                resetBtn.addEventListener('click', function() {
                    console.log('重置棋谱演示');
                    // 显示棋谱选择界面
                    document.querySelector('.record-selection').classList.remove('hidden');

                    // 隐藏棋谱步骤界面
                    document.getElementById('recordDisplay').classList.add('hidden');

                    // 重置游戏
                    if (window.game && window.game.resetGame) {
                        window.game.resetGame();
                    }
                });
            }

            // 播放按钮
            const playBtn = document.getElementById('playBtn');
            if (playBtn) {
                playBtn.addEventListener('click', function() {
                    console.log('开始自动演示');
                    if (window.game) {
                        if (window.game.autoPlayFullGame) {
                            window.game.autoPlayFullGame();
                        } else {
                            console.log('❌ autoPlayFullGame方法不存在');
                            alert('自动演示功能暂时不可用');
                        }
                    } else {
                        console.log('❌ 游戏对象不存在');
                        alert('游戏尚未初始化');
                    }
                });
            }

            // 全局棋谱按钮
            const showGameRecordsBtn = document.getElementById('showGameRecords');
            if (showGameRecordsBtn) {
                showGameRecordsBtn.addEventListener('click', function() {
                    console.log('显示棋谱面板');
                    if (window.game && window.game.showRecordPanel) {
                        window.game.showRecordPanel();
                        // 显示分类选择
                        if (window.game.showClassificationPanel) {
                           window.game.showClassificationPanel();
                        }
                  } else {
                        const recordPanel = document.getElementById('recordPanel');
                        if (recordPanel) {
                            recordPanel.classList.remove('hidden');
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
