<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­å›½è±¡æ£‹ - å•æœºç‰ˆ</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .series-btn {
            position: relative;
            text-align: left;
            padding: 12px 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            margin: 5px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .series-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            background: linear-gradient(135deg, #764ba2, #667eea);
        }
        
        .game-count {
            position: absolute;
            right: 10px;
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .series-games-list {
            max-height: 500px;
            overflow-y: auto;
            margin-top: 15px;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }
        
        .series-game-item {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .series-game-item:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .game-title {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .game-info {
            color: #87ceeb;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .game-meta {
            color: #98fb98;
            font-size: 0.85em;
            margin-bottom: 5px;
        }
        
        .game-moves {
            color: #ffa07a;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .game-quality {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75em;
            margin-left: 8px;
            background: rgba(255,255,255,0.2);
        }
        
        .back-btn {
            background: linear-gradient(135deg, #666, #888);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: linear-gradient(135deg, #888, #aaa);
            transform: translateY(-1px);
        }
        
        .series-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255,255,255,0.3);
        }
    </style>
    <script src="audio-manager.js"></script>
    <script src="chess-notation-parser.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ä¸­å›½è±¡æ£‹</h1>
            <div class="game-controls">
                <button id="newGame">æ–°æ¸¸æˆ</button>
                <button id="undo">æ‚”æ£‹</button>
                <button id="showGameRecords">å…¨å±€æ£‹è°±</button>
                <button id="audioToggle" class="audio-btn">ğŸ”Š éŸ³æ•ˆ</button>
            </div>
            
            <!-- éŸ³é‡æ§åˆ¶é¢æ¿ -->
            <div id="audioControls" class="audio-controls">
                <div class="volume-control">
                    <label for="musicVolume">ğŸµ èƒŒæ™¯éŸ³ä¹:</label>
                    <input type="range" id="musicVolume" min="0" max="100" value="30" class="volume-slider">
                    <span id="musicVolumeValue">30%</span>
                </div>
                <div class="volume-control">
                    <label for="effectVolume">ğŸ”Š éŸ³æ•ˆ:</label>
                    <input type="range" id="effectVolume" min="0" max="100" value="60" class="volume-slider">
                    <span id="effectVolumeValue">60%</span>
                </div>
            </div>
        </header>

        <div class="game-board">
            <div class="board">
                <!-- æ£‹ç›˜æ ¼å­å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="status">
                <div id="currentPlayer">å½“å‰å›åˆ: çº¢æ–¹</div>
                <div id="gameStatus">æ¸¸æˆçŠ¶æ€: è¿›è¡Œä¸­</div>
            </div>
        </div>

        <div class="captured-pieces">
            <div class="red-captured">è¢«åƒçº¢å­: </div>
            <div class="black-captured">è¢«åƒé»‘å­: </div>
        </div>
    </div>

    <!-- æ£‹è°±å±•ç¤ºé¢æ¿ -->
    <div id="recordPanel" class="record-panel hidden">
        <div class="record-header">
            <h2>ç»å…¸æ£‹è°±é€‰æ‹©</h2>
            <button id="closeRecords" class="close-btn">Ã—</button>
        </div>
        
        <!-- åˆ†ç±»å¯¼èˆªåŒºåŸŸ -->
        <div class="classification-nav">
            <button id="categoryToggle" class="category-toggle-btn">ğŸ“‚ åˆ†ç±»ç›®å½•</button>
            <div id="categorySelection" class="category-selection hidden">
                <h4>æ£‹è°±åˆ†ç±»</h4>
                <div id="categoryList" class="category-list">
                    <!-- åŠ¨æ€åˆ†ç±»åˆ—è¡¨å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- æ£‹è°±é€‰æ‹©æŒ‰é’®åŒºåŸŸ -->
        <div class="record-selection">
            <h3>é€‰æ‹©æ£‹è°±ï¼š</h3>
            <div id="recordButtons" class="record-buttons">
                <!-- åˆ†ç±»æ£‹è°±å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- æ£‹è°±æ­¥éª¤å±•ç¤ºåŒºåŸŸ -->
        <div id="recordDisplay" class="record-display hidden">
            <div class="record-info">
                <h3 id="recordTitle">æ£‹è°±åç§°</h3>
                <div class="play-controls">
                    <button id="playBtn">â–¶ æ’­æ”¾</button>
                    <button id="pauseBtn">â¸ æš‚åœ</button>
                    <button id="resetBtn">â†» é‡ç½®</button>
                    <div class="speed-control">
                        <label>é€Ÿåº¦ï¼š</label>
                        <select id="playSpeed">
                            <option value="2000">æ…¢é€Ÿ</option>
                            <option value="1000" selected>æ­£å¸¸</option>
                            <option value="500">å¿«é€Ÿ</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="record-steps">
                <ol id="stepsList" class="steps-list">
                    <!-- æ£‹è°±æ­¥éª¤å°†ç”±JavaScriptç”Ÿæˆ -->
                </ol>
            </div>
        </div>

        <!-- æ£‹è°±ç³»åˆ—å±•ç¤ºåŒºåŸŸ -->
        <div id="seriesDisplay" class="record-display hidden">
            <div class="series-header">
                <h3 id="seriesTitle">æ£‹è°±ç³»åˆ—</h3>
                <button id="backToSeries" class="back-btn">â† è¿”å›ç³»åˆ—åˆ—è¡¨</button>
            </div>
            <div class="series-info" id="seriesInfo">
                <!-- ç³»åˆ—ç»Ÿè®¡ä¿¡æ¯ -->
            </div>
            <div class="series-games-list" id="seriesGamesList">
                <!-- ç³»åˆ—ä¸­çš„æ£‹è°±åˆ—è¡¨å°†ç”±JavaScriptç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script src="chess.js"></script>
    <script>
        // æ¸¸æˆåˆå§‹åŒ–å’Œäº¤äº’åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ä¸­å›½è±¡æ£‹é¡µé¢åŠ è½½å®Œæˆ');

            setTimeout(() => {
                if (window.game) {
                    console.log('âœ… æ¸¸æˆåˆå§‹åŒ–æˆåŠŸ');
                    console.log('æ£‹å­æ•°é‡:', window.game.pieces.length);
                } else {
                    console.log('âŒ æ¸¸æˆåˆå§‹åŒ–å¤±è´¥');
                }
            }, 500);

            // å…³é—­æ£‹è°±é¢æ¿æŒ‰é’®
            const closeRecordsBtn = document.getElementById('closeRecords');
            if (closeRecordsBtn) {
                closeRecordsBtn.addEventListener('click', function() {
                    const recordPanel = document.getElementById('recordPanel');
                    if (recordPanel) {
                        recordPanel.classList.add('hidden');
                        console.log('æ£‹è°±é¢æ¿å·²å…³é—­');
                    }
                });
            }

            // åˆ†ç±»åŠŸèƒ½æ§åˆ¶
            const categoryToggle = document.getElementById('categoryToggle');
   const categorySelection = document.getElementById('categorySelection');

         if (categoryToggle && categorySelection) {
                // åˆ†ç±»åˆ‡æ¢æŒ‰é’®äº‹ä»¶
          categoryToggle.addEventListener('click', function() {
     categorySelection.classList.toggle('hidden');
      console.log('åˆ†ç±»é¢æ¿åˆ‡æ¢:', !categorySelection.classList.contains('hidden'));

                // å¦‚æœæ‰“å¼€åˆ†ç±»é¢æ¿ï¼Œæ˜¾ç¤ºåˆ†ç±»æ£‹è°±
       if (!categorySelection.classList.contains('hidden') && window.game) {
     window.game.showClassificationPanel();
     }
        });
        }

            // æ£‹è°±é€‰æ‹©æŒ‰é’®
            const recordButtons = document.querySelectorAll('.record-btn');
       console.log('æ‰¾åˆ°æ£‹è°±æŒ‰é’®:', recordButtons.length);

            recordButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const gameName = this.getAttribute('data-game');
                    console.log('é€‰æ‹©æ£‹è°±:', gameName);

                    if (window.game && window.game.setupFamousGame) {
                        // éšè—æ£‹è°±é€‰æ‹©ç•Œé¢
                        document.querySelector('.record-selection').classList.add('hidden');

                        // æ˜¾ç¤ºæ£‹è°±æ­¥éª¤ç•Œé¢
                        document.getElementById('recordDisplay').classList.remove('hidden');

                        // è®¾ç½®æ ‡é¢˜
                        document.getElementById('recordTitle').textContent = gameName;

                        // åŠ è½½æ£‹å±€
                        window.game.setupFamousGame(gameName);
                        console.log('æ£‹è°±åŠ è½½å®Œæˆ:', gameName);
                    } else {
                        console.log('âŒ æ¸¸æˆå¯¹è±¡æˆ–æ–¹æ³•ä¸å¯ç”¨');
                        alert('æ¸¸æˆå°šæœªåˆå§‹åŒ–å®Œæˆï¼Œè¯·ç¨åå†è¯•');
                    }
                });
            });

            // é‡ç½®æŒ‰é’®
            const resetBtn = document.getElementById('resetBtn');
            if (resetBtn) {
                resetBtn.addEventListener('click', function() {
                    console.log('é‡ç½®æ£‹è°±æ¼”ç¤º');
                    // æ˜¾ç¤ºæ£‹è°±é€‰æ‹©ç•Œé¢
                    document.querySelector('.record-selection').classList.remove('hidden');

                    // éšè—æ£‹è°±æ­¥éª¤ç•Œé¢
                    document.getElementById('recordDisplay').classList.add('hidden');

                    // é‡ç½®æ¸¸æˆ
                    if (window.game && window.game.resetGame) {
                        window.game.resetGame();
                    }
                });
            }

            // æ’­æ”¾æŒ‰é’®
            const playBtn = document.getElementById('playBtn');
            if (playBtn) {
                playBtn.addEventListener('click', function() {
                    console.log('å¼€å§‹è‡ªåŠ¨æ¼”ç¤º');
                    if (window.game) {
                        if (window.game.autoPlayFullGame) {
                            window.game.autoPlayFullGame();
                        } else {
                            console.log('âŒ autoPlayFullGameæ–¹æ³•ä¸å­˜åœ¨');
                            alert('è‡ªåŠ¨æ¼”ç¤ºåŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨');
                        }
                    } else {
                        console.log('âŒ æ¸¸æˆå¯¹è±¡ä¸å­˜åœ¨');
                        alert('æ¸¸æˆå°šæœªåˆå§‹åŒ–');
                    }
                });
            }

            // å…¨å±€æ£‹è°±æŒ‰é’®
            const showGameRecordsBtn = document.getElementById('showGameRecords');
            if (showGameRecordsBtn) {
                showGameRecordsBtn.addEventListener('click', function() {
                    console.log('æ˜¾ç¤ºæ£‹è°±é¢æ¿');
                    if (window.game && window.game.showRecordPanel) {
                        window.game.showRecordPanel();
                        // æ˜¾ç¤ºåˆ†ç±»é€‰æ‹©
                        if (window.game.showClassificationPanel) {
                           window.game.showClassificationPanel();
                        }
                  } else {
                        const recordPanel = document.getElementById('recordPanel');
                        if (recordPanel) {
                            recordPanel.classList.remove('hidden');
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
