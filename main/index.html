<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­å›½è±¡æ£‹ - å•æœºç‰ˆ</title>
    <link rel="stylesheet" href="style.css">
    <script src="audio-manager.js"></script>
    <script src="chess-notation-parser.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ä¸­å›½è±¡æ£‹</h1>
            <div class="game-controls">
                <button id="newGame">æ–°æ¸¸æˆ</button>
                <button id="undo">æ‚”æ£‹</button>
                <button id="showGameRecords">å…¨å±€æ£‹è°±</button>
                <button id="audioToggle" class="audio-btn">ğŸ”Š éŸ³æ•ˆ</button>
            </div>
            
            <!-- éŸ³é‡æ§åˆ¶é¢æ¿ -->
            <div id="audioControls" class="audio-controls">
                <div class="volume-control">
                    <label for="musicVolume">ğŸµ èƒŒæ™¯éŸ³ä¹:</label>
                    <input type="range" id="musicVolume" min="0" max="100" value="30" class="volume-slider">
                    <span id="musicVolumeValue">30%</span>
                </div>
                <div class="volume-control">
                    <label for="effectVolume">ğŸ”Š éŸ³æ•ˆ:</label>
                    <input type="range" id="effectVolume" min="0" max="100" value="60" class="volume-slider">
                    <span id="effectVolumeValue">60%</span>
                </div>
            </div>
        </header>

        <div class="game-board">
            <div class="board">
                <!-- æ£‹ç›˜æ ¼å­å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="status">
                <div id="currentPlayer">å½“å‰å›åˆ: çº¢æ–¹</div>
                <div id="gameStatus">æ¸¸æˆçŠ¶æ€: è¿›è¡Œä¸­</div>
            </div>
        </div>

        <div class="captured-pieces">
            <div class="red-captured">è¢«åƒçº¢å­: </div>
            <div class="black-captured">è¢«åƒé»‘å­: </div>
        </div>
    </div>

    <!-- æ£‹è°±å±•ç¤ºé¢æ¿ -->
    <div id="recordPanel" class="record-panel hidden">
        <div class="record-header">
            <h2>ç»å…¸æ£‹è°±é€‰æ‹©</h2>
            <button id="closeRecords" class="close-btn">Ã—</button>
        </div>
        
        <!-- æ£‹è°±é€‰æ‹©æŒ‰é’®åŒºåŸŸ -->
        <div class="record-selection">
            <h3>é€‰æ‹©æ£‹è°±ï¼š</h3>
            <div id="recordButtons" class="record-buttons">
                <!-- ç»å…¸æ®‹å±€ -->
                <div class="record-category">
                    <h4>ç»å…¸æ®‹å±€</h4>
                    <button class="record-btn" data-game="ä¸ƒæ˜Ÿèšä¼š">ä¸ƒæ˜Ÿèšä¼š</button>
                    <button class="record-btn" data-game="èš¯èš“é™é¾™">èš¯èš“é™é¾™</button>
                    <button class="record-btn" data-game="é‡é©¬æ“ç”°">é‡é©¬æ“ç”°</button>
                    <button class="record-btn" data-game="åƒé‡Œç‹¬è¡Œ">åƒé‡Œç‹¬è¡Œ</button>
                </div>

                <!-- ç»å…¸å¼€å±€ -->
                <div class="record-category">
                    <h4>ç»å…¸å¼€å±€</h4>
                    <button class="record-btn" data-game="ä¸­ç‚®å¯¹å±é£é©¬ç»å…¸">ä¸­ç‚®å¯¹å±é£é©¬</button>
                    <button class="record-btn" data-game="ä¸­ç‚®å¯¹é¡ºç‚®å¯¹æ”»">ä¸­ç‚®å¯¹é¡ºç‚®</button>
                    <button class="record-btn" data-game="ä»™äººæŒ‡è·¯å¯¹ä¸­ç‚®">ä»™äººæŒ‡è·¯</button>
                    <button class="record-btn" data-game="èƒ¡è£ååå±€ç²¾é€‰">èƒ¡è£ååå±€</button>
                    <button class="record-btn" data-game="è®¸é“¶å·åå±€ç²¾é€‰">è®¸é“¶å·åå±€</button>
                </div>
            </div>
        </div>
        
        <!-- æ£‹è°±æ­¥éª¤å±•ç¤ºåŒºåŸŸ -->
        <div id="recordDisplay" class="record-display hidden">
            <div class="record-info">
                <h3 id="recordTitle">æ£‹è°±åç§°</h3>
                <div class="play-controls">
                    <button id="playBtn">â–¶ æ’­æ”¾</button>
                    <button id="pauseBtn">â¸ æš‚åœ</button>
                    <button id="resetBtn">â†» é‡ç½®</button>
                    <div class="speed-control">
                        <label>é€Ÿåº¦ï¼š</label>
                        <select id="playSpeed">
                            <option value="2000">æ…¢é€Ÿ</option>
                            <option value="1000" selected>æ­£å¸¸</option>
                            <option value="500">å¿«é€Ÿ</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="record-steps">
                <ol id="stepsList" class="steps-list">
                    <!-- æ£‹è°±æ­¥éª¤å°†ç”±JavaScriptç”Ÿæˆ -->
                </ol>
            </div>
        </div>
    </div>

    <script src="chess.js"></script>
    <script>
        // æ¸¸æˆåˆå§‹åŒ–å’Œäº¤äº’åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ä¸­å›½è±¡æ£‹é¡µé¢åŠ è½½å®Œæˆ');

            setTimeout(() => {
                if (window.game) {
                    console.log('âœ… æ¸¸æˆåˆå§‹åŒ–æˆåŠŸ');
                    console.log('æ£‹å­æ•°é‡:', window.game.pieces.length);
                } else {
                    console.log('âŒ æ¸¸æˆåˆå§‹åŒ–å¤±è´¥');
                }
            }, 500);

            // å…³é—­æ£‹è°±é¢æ¿æŒ‰é’®
            const closeRecordsBtn = document.getElementById('closeRecords');
            if (closeRecordsBtn) {
                closeRecordsBtn.addEventListener('click', function() {
                    const recordPanel = document.getElementById('recordPanel');
                    if (recordPanel) {
                        recordPanel.classList.add('hidden');
                        console.log('æ£‹è°±é¢æ¿å·²å…³é—­');
                    }
                });
            }

            // æ£‹è°±é€‰æ‹©æŒ‰é’®
            const recordButtons = document.querySelectorAll('.record-btn');
            console.log('æ‰¾åˆ°æ£‹è°±æŒ‰é’®:', recordButtons.length);

            recordButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const gameName = this.getAttribute('data-game');
                    console.log('é€‰æ‹©æ£‹è°±:', gameName);

                    if (window.game && window.game.setupFamousGame) {
                        // éšè—æ£‹è°±é€‰æ‹©ç•Œé¢
                        document.querySelector('.record-selection').classList.add('hidden');

                        // æ˜¾ç¤ºæ£‹è°±æ­¥éª¤ç•Œé¢
                        document.getElementById('recordDisplay').classList.remove('hidden');

                        // è®¾ç½®æ ‡é¢˜
                        document.getElementById('recordTitle').textContent = gameName;

                        // åŠ è½½æ£‹å±€
                        window.game.setupFamousGame(gameName);
                        console.log('æ£‹è°±åŠ è½½å®Œæˆ:', gameName);
                    } else {
                        console.log('âŒ æ¸¸æˆå¯¹è±¡æˆ–æ–¹æ³•ä¸å¯ç”¨');
                        alert('æ¸¸æˆå°šæœªåˆå§‹åŒ–å®Œæˆï¼Œè¯·ç¨åå†è¯•');
                    }
                });
            });

            // é‡ç½®æŒ‰é’®
            const resetBtn = document.getElementById('resetBtn');
            if (resetBtn) {
                resetBtn.addEventListener('click', function() {
                    console.log('é‡ç½®æ£‹è°±æ¼”ç¤º');
                    // æ˜¾ç¤ºæ£‹è°±é€‰æ‹©ç•Œé¢
                    document.querySelector('.record-selection').classList.remove('hidden');

                    // éšè—æ£‹è°±æ­¥éª¤ç•Œé¢
                    document.getElementById('recordDisplay').classList.add('hidden');

                    // é‡ç½®æ¸¸æˆ
                    if (window.game && window.game.resetGame) {
                        window.game.resetGame();
                    }
                });
            }

            // æ’­æ”¾æŒ‰é’®
            const playBtn = document.getElementById('playBtn');
            if (playBtn) {
                playBtn.addEventListener('click', function() {
                    console.log('å¼€å§‹è‡ªåŠ¨æ¼”ç¤º');
                    if (window.game) {
                        if (window.game.autoPlayFullGame) {
                            window.game.autoPlayFullGame();
                        } else {
                            console.log('âŒ autoPlayFullGameæ–¹æ³•ä¸å­˜åœ¨');
                            alert('è‡ªåŠ¨æ¼”ç¤ºåŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨');
                        }
                    } else {
                        console.log('âŒ æ¸¸æˆå¯¹è±¡ä¸å­˜åœ¨');
                        alert('æ¸¸æˆå°šæœªåˆå§‹åŒ–');
                    }
                });
            }

            // å…¨å±€æ£‹è°±æŒ‰é’®
            const showGameRecordsBtn = document.getElementById('showGameRecords');
            if (showGameRecordsBtn) {
                showGameRecordsBtn.addEventListener('click', function() {
                    console.log('æ˜¾ç¤ºæ£‹è°±é¢æ¿');
                    if (window.game && window.game.showRecordPanel) {
                        window.game.showRecordPanel();
                    } else {
                        const recordPanel = document.getElementById('recordPanel');
                        if (recordPanel) {
                            recordPanel.classList.remove('hidden');
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>